import math
import random
import os

import gym
import numpy as np

import torch
import torch.nn as nn
import torch.optim as optim
import torch.nn.functional as F
from torch.distributions import Categorical

use_cuda = torch.cuda.is_available()
device   = torch.device("cuda" if use_cuda else "cpu")

from common.multiprocessing_env import SubprocVecEnv

num_envs = os.cpu_count()
env_name = "CartPole-v0"

def make_env():
    def _thunk():
        env = gym.make(env_name)
        return env

    return _thunk

envs = [make_env() for i in range(num_envs)]
envs = SubprocVecEnv(envs)

env = gym.make(env_name)

class ActorCritic(nn.Module):
    def __init__(self,num_inputs, num_outputs, hidden_size,std=0.0 ):
        super(ActorCritic,self).__init__()

    self.critic = nn.Sequential(
        nn.Linear(num_inputs, hidden_size),
        nn.ReLU(),
        nn.Linear(hidden_size, 1)
    )

    self.actor = nn.Sequential(
        nn.Linear(num_inputs, hidden_size),
        nn.ReLU(),
        nn.Linear(hidden_size, num_outputs),
        nn.Softmax(dim=1),
    )


def forward(self, x):
    value = self.critic(x)
    probs = self.actor(x)
    dist = Categorical(probs)
    return dist, value